# 搜索能力优化计划

## 当前状态
- ✅ 基础项目结构已建立
- ✅ GitHub 仓库已创建
- ✅ DuckDuckGo HTML 抓取方案可用（备选）
- ❌ 传统搜索引擎 API 缺失
- ❌ 浏览器自动化被反爬虫拦截

## 问题分析

### 根本原因
1. **API 缺失**：Brave Search API 未配置，Google/Bing 等 API 需要付费
2. **反爬虫机制**：Google、Bing 等对 headless 浏览器有检测（Cloudflare、CAPTCHA）
3. **第三方库失效**：CSS 选择器依赖页面结构，容易失效

### 可用资源
- ✅ 完整网络访问能力
- ✅ GitHub 账户（可以开源协作）
- ✅ DuckDuckGo HTML 端点
- ✅ GitHub API 可用

## 分阶段优化计划

### 阶段 1：验证更多搜索源（当前阶段）

#### 目标
测试其他可能可用的搜索引擎和搜索方式。

#### 任务
- [ ] 测试更多搜索引擎：
  - [ ] Startpage（隐私搜索引擎）
  - [ ] Brave Search（无需 API 的前端）
  - [ ] SearXNG（开源元搜索引擎）
  - [ ] Qwant（欧洲隐私搜索引擎）
- [ ] 测试 GitHub 内部搜索（Issues、Discussions、Code）
- [ ] 测试其他社区搜索：
  - [ ] Stack Overflow
  - [ ] Reddit
  - [ ] Hacker News

#### 预期产出
- 可用搜索源清单（成功率、延迟、限制）
- 每个搜索源的简单封装代码

---

### 阶段 2：反爬虫绕过探索

#### 目标
研究并测试绕过搜索引擎反爬虫机制的方法。

#### 任务
- [ ] 研究 Cloudflare 挑战的绕过方法：
  - [ ] TLS 指纹伪装
  - [ ] User-Agent 轮换
  - [ ] HTTP/2 协议模拟
- [ ] 测试不同的浏览器自动化方案：
  - [ ] Playwright 的反检测模式
  - [ ] Puppeteer-extra-plugin-stealth
  - [ ] undetected-chromedriver
- [ ] 研究 Selenium/Playwright 的 headless 检测特征
- [ ] 测试代理 IP 轮换（如果可用）

#### 预期产出
- 可行性报告（哪些方法有效，哪些无效）
- 示例代码（如果成功）

---

### 阶段 3：搜索 API 集成

#### 目标
尽可能集成可用的免费搜索 API。

#### 任务
- [ ] 调研免费搜索 API：
  - [ ] SerpAPI（有免费额度）
  - [ ] SerpStack（免费层）
  - [ ] Google Programmable Search Engine（免费层）
  - [ ] DuckDuckGo Instant Answer API
- [ ] 测试每个 API：
  - [ ] 注册流程
  - [ ] 免费额度限制
  - [ ] 响应质量
  - [ ] 延迟
- [ ] 实现 API 统一接口（适配器模式）

#### 预期产出
- 可用 API 清单（限制、质量、延迟）
- 统一的搜索接口封装

---

### 阶段 4：混合搜索策略

#### 目标
构建一个能自动选择最佳搜索源的智能系统。

#### 任务
- [ ] 设计搜索源选择策略：
  - [ ] 根据查询类型选择源（代码→GitHub，新闻→...）
  - [ ] 根据可用性自动切换（失败时尝试下一个）
  - [ ] 根据历史成功率排序
- [ ] 实现结果去重和排序
- [ ] 实现缓存机制（避免重复搜索）
- [ ] 添加搜索历史记录

#### 预期产出
- 混合搜索系统代码
- 搜索源选择算法文档

---

### 阶段 5：自动化与监控

#### 目标
建立自动化测试和监控，确保搜索能力的稳定性。

#### 任务
- [ ] 编写搜索源健康检查脚本
- [ ] 设置定时测试（检测失败）
- [ ] 建立搜索成功率监控
- [ ] 添加日志记录（失败原因、响应时间）
- [ ] 集成到 OpenClaw 工具（如可能）

#### 预期产出
- 监控 Dashboard（或日志）
- 自动化测试脚本
- 告警机制

---

## 技术债务与风险

| 风险 | 缓解措施 |
|------|----------|
| 搜索源可能随时失效 | 建立多源备份，快速切换 |
| IP 可能被封 | 使用代理轮换（如果可用） |
| 第三方库更新导致失效 | 定期测试，快速修复 |
| 免费额度耗尽 | 监控使用量，及时切换 |

## 时间规划

- **阶段 1**：1-2 天
- **阶段 2**：2-3 天
- **阶段 3**：1-2 天
- **阶段 4**：2-3 天
- **阶段 5**：1-2 天

总计：**7-12 天**

## 成功指标

1. 可用搜索源数量：≥3
2. 搜索成功率：≥80%
3. 平均响应时间：<3 秒
4. 自动恢复时间：<10 分钟

---

## 开始执行

**当前任务**：阶段 1 - 验证更多搜索源

**下一步行动**：
1. 测试 Startpage 搜索
2. 测试 GitHub 搜索
3. 测试 Hacker News 搜索

**负责人**：Sisyphus
